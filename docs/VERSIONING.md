# Auto-Incrementing Version System

## Overview

The Habit Tracker app uses an auto-incrementing build version system that automatically increments the version number each time the app is deployed to GitHub Pages. This allows tracking which build is currently deployed and provides transparency to users about the app version.

## How It Works

### Components

1. **version.json** - Stores the current build number
   - Located at the root of the repository
   - Contains a simple JSON object: `{ "buildNumber": X }`
   - Tracked in Git to persist across builds

2. **scripts/increment_version.dart** - Script that increments the version
   - Reads the current build number from `version.json`
   - Increments it by 1
   - Writes the new build number back to `version.json`
   - Generates `lib/generated/version.dart` with the new version

3. **lib/generated/version.dart** - Generated Dart file containing version constants
   - Auto-generated by `increment_version.dart`
   - Contains `AppVersion` class with `buildNumber` and `version` constants
   - Imported by `AboutScreen` to display the version

4. **GitHub Actions Workflow** - Automates the version increment
   - `.github/workflows/deploy-gh-pages.yml` runs the increment script
   - Commits the updated files back to the repository
   - Builds and deploys the app with the new version

### Workflow Steps

When code is pushed to the `main` branch:

1. GitHub Actions checks out the code
2. Sets up Flutter environment
3. Installs dependencies
4. **Runs `dart scripts/increment_version.dart`** to increment the version
5. **Commits the incremented version** back to the repository with message `chore: increment build version [skip ci]`
6. Builds the Flutter web app
7. Deploys to GitHub Pages

### Version Format

The version is displayed as: `1.0.0+{buildNumber}`

- `1.0.0` - Semantic version (can be manually updated in the script)
- `+{buildNumber}` - Auto-incrementing build number

Example: `1.0.0+42` means version 1.0.0, build 42

## Usage

### Viewing the Version

Users can see the current version by:
1. Opening the app
2. Going to Settings
3. Tapping "About"
4. The version is displayed under the app name

### Manual Version Increment (Testing)

To manually test the version increment:

```bash
# Run the increment script
dart scripts/increment_version.dart

# View the updated version
cat version.json
cat lib/generated/version.dart
```

### Updating the Semantic Version

To change the semantic version (e.g., from 1.0.0 to 2.0.0):

1. Edit `scripts/increment_version.dart`
2. Update the `semanticVersion` constant at the top of the file:
   ```dart
   const String semanticVersion = '2.0.0';
   ```
3. Commit the change
4. The next deployment will use the new semantic version with the current build number

## Files Modified

- `.github/workflows/deploy-gh-pages.yml` - Added version increment step
- `lib/screens/about_screen.dart` - Import and use `AppVersion.version`
- `test/about_screen_test.dart` - Updated test to use dynamic version
- `README.md` - Added documentation about versioning

## Files Created

- `version.json` - Stores current build number
- `scripts/increment_version.dart` - Increment script
- `lib/generated/version.dart` - Generated version constants

## Notes

- The `[skip ci]` flag in the commit message prevents infinite loops (the version commit doesn't trigger another build)
- The version files are tracked in Git to ensure version persistence
- The build number always increments, even if the deployment fails
- The generated file has a header comment indicating it's auto-generated
